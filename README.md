# Raspi Time Lapse Script

This Bash script automates the process of creating a time-lapse video from sunrise to sunset, adding a text overlay with various information, backing up the video to a remote server, and uploading it to YouTube. 
*Absolutely no warranty for anything given.*

## Features

- **Time-Lapse Capture**: Uses `libcamera` for capturing images.
- **Config File**: Includes a config file for clean settings.
- **Placeholders**: Certain strings can be set by placeholders and dynamically updated, e.g., for a YouTube description or title.
- **Text Overlay**: Adds date, time, sunrise/sunset times, weather conditions, and system temperature to each image.
- **Dynamic Timing**: Starts capturing images based on sunrise with an offset and stops after sunset with an offset.
- **Remote Backup**: Optionally uploads the video to a Linux server via SCP.
- **Netatmo Integration**: Optionally reads weather information from a weather text file: [Netatmo Weather](https://github.com/noviceiii/netatmoweather).
- **YouTube Integration**: Optionally uploads the video to YouTube with custom title and description placeholders: [YouTube Upload](https://github.com/noviceiii/youtube-upload).

## Prerequisites

- **Raspberry Pi** with Bash shell
- **libcamera** installed for image capture
- **font** you need a font file for the text overlay
- **hdate** for calculating sunrise/sunset times
- **ffmpeg** for video creation and text overlay
- **Netatmo script** for weather lookups (if enabled)
- **Python** and the `youtube-upload` script for YouTube uploads (if enabled)

## Configuration

- **config.cfg**: Contains all configurable parameters for the script.

- **DEBUG**: 
  - `debug`: Enables debug mode, which limits the number of pictures taken.
  - `z`: Number of pictures to take in debug mode.
  - `FORCE_SCP_UPLOAD` and `FORCE_YT_UPLOAD`: Forces uploads in debug mode.

- **SCRIPT SETTINGS**:
  - `INTERVAL`: Time interval between captures.
  - `offSTART`, `offEND`: Time offset for starting before sunrise and ending after sunset.
  - `RESW`, `RESH`: Image resolution.
  - `DT`: Display time for each image in the video.
  - `vidpref`: Prefix for the video file name.
  - `LONG`, `LAT`, `TIZO`: Location settings for time calculations. TIZO is the hour offset of your UTC time. E.g 1 for UTC+1.
  - `TDIR`: Temporary directory for image storage.
  - `FPATH`: Path to the font file for the text overlay.

  Get the longitude and latitude from here https://latitudelongitude.org/map-address-latlong in decimal format.

- **WEATHER**: Optionally include weather information in the overlay generated by this script: [Netatmo Weather](https://github.com/noviceiii/netatmoweather).

- **LOCAL SERVER PATH**: SCP settings for remote backup (optional).

- **YOUTUBE**: Optional. Settings for YouTube upload, including placeholders for dynamic content in titles and descriptions. Use this script for uploads: [YouTube Upload](https://github.com/noviceiii/youtube-upload).

### Placeholders for YouTube Title and Description

- **[SUNRISE]**: Replaced with the time of the sunrise (`$tsunrise`).
- **[FIRSTLIGHT]**: Replaced with the time of the first light (`$first_light`).
- **[START-OFFSET]**: Replaced with the time of the offset to the sunrise or first light (`$offSTART`).
- **[SUNSET]**: Replaced with the time of the sunset (`$tsunset`).
- **[SUNSET-OFFSET]**: Replaced with the time of the offset to the sunset (`$offEND`).
- **[IMAGE-COUNT]**: Number of images created (`$i`).
- **[IMAGE-COUNT-FORMATED]**: Number of images created with leading zero (`$formatted_i`).
- **[INTERVAL]**: Interval at which pictures are taken (`$INTERVAL`).
- **[HEIGHT]**: The height of the image (`$RESH`).
- **[WIDTH]**: The width of the image (`$RESW`) - Note: in the code, this is referred to as `LENGTH`.
- **[FRAMERATE]**: The framerate used (`$fr`).
- **[FORMATTED_DATE]**: Formatted date as dd.mm.yyyy (`$tsfriendly`).
- **[FORMATED_DATETIME]**: Replaced with the value of the variable `ts` (`$tsoverlay`).
- **[INT-TEMP]**: Internal Temperature of device (`$obrdtmp`).
- **[WEATHER]**: Weather information if enabled (`$weather`).
- **[LATITUDE]**: Latitude of the location (`$LAT`).
- **[LONGITUDE]**: Longitude of the location (`$LONG`).
- **[PLAYLIST]**: YouTube playlist name or ID (`$PLAYLIST`).
- **[YOUTUBE-CATEGORY]**: YouTube video category (`$YOUTUBE_CATEGORY`).
- **[YOUTUBE-LANGUAGE]**: Language of the YouTube video (`$YOUTUBE_LANGUAGE`).
- **[YOUTUBE-PRIVACY]**: Privacy status for the YouTube video (`$YOUTUBE_PRIVACY`).
- **[YOUTUBE-TAGS]**: Tags for the YouTube video (`$YOUTUBE_TAGS`).

## Usage

1. **Setup**: 
   - Adjust the `config.cfg` according to your environment and preferences. Rename the example `config.example.cfg` to `config.cfg` to start with.
   - Ensure all necessary software is installed.

2. **Run the Script**:
   ```bash
   ./pilapse.sh
   ```

3. **Output**: 
   - Images are stored in a timestamped folder in `/tmp`.
   - A video is created from these images with a text overlay.
   - Optionally, the video is uploaded to a server or YouTube.

## Troubleshooting

If the script fails to start or operate, check if `config.cfg` exists at the correct path. Ensure all permissions are set correctly for script execution and file writing.

## Acknowledgments

Thanks to the authors of libcamera, ffmpeg, hdate, and the youtube-upload script for their contributions to open-source software.